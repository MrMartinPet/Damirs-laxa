<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Norden ‚Äì Karta Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body{
    margin:0;
    padding:10px;
    font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;
    background:#f4f4f4;
  }
  h1{
    text-align:center;
    font-size:1.4rem;
    margin:4px 0 2px;
  }
  .subtitle{
    text-align:center;
    font-size:0.85rem;
    color:#555;
    margin-bottom:8px;
  }
  .map{
    position:relative;
    width:100%;
    max-width:420px;
    margin:auto;
    aspect-ratio:3/4;
    background:#dde url("nordenkarta.jpg") center/contain no-repeat;
    border-radius:14px;
    overflow:hidden;
    box-shadow:0 2px 6px rgba(0,0,0,.2);
  }
  .cluster{
    position:absolute;
    transform:translate(-50%,-50%);
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:2px;
  }
  .cluster::before{
    content:"";
    position:absolute;
    z-index:-1;
    width:70px;
    height:70px;
    border-radius:50%;
    background:rgba(255,255,255,.5);
    border:1px solid rgba(0,0,0,.08);
  }
  .cluster.small::before{
    width:60px;
    height:60px;
  }
  .label-row{
    display:flex;
    gap:4px;
    font-size:0.6rem;
  }
  .label-pill{
    padding:1px 4px;
    border-radius:999px;
    background:rgba(0,0,0,.06);
  }
  .field-row{
    display:flex;
    gap:3px;
  }
  input{
    width:80px;
    font-size:0.65rem;
    padding:3px 4px;
    border-radius:6px;
    border:1px solid #aaa;
    text-align:center;
    background:rgba(255,255,255,.9);
  }
  .country-input{
    width:78px;
  }
  .capital-input{
    width:78px;
  }
  .flag{
    font-size:1rem;
    text-align:center;
    height:1.1rem;
  }
  .single-label{
    font-size:0.65rem;
    padding:1px 4px;
    border-radius:6px;
    background:rgba(0,0,0,.05);
    margin-bottom:1px;
  }
  .single-input{
    width:80px;
  }
  .correct{
    border:2px solid #2a8f2a !important;
    background:#d2f4d2 !important;
  }
  .wrong{
    border:2px solid #c33 !important;
    background:#f8d6d6 !important;
  }
  #info{
    max-width:420px;
    margin:8px auto 2px;
    font-size:0.8rem;
    color:#444;
  }
  #score{
    max-width:420px;
    margin:2px auto 6px;
    font-size:0.8rem;
    font-weight:600;
    text-align:center;
  }
  #btns{
    display:flex;
    gap:6px;
    max-width:420px;
    margin:0 auto;
  }
  button{
    flex:1;
    padding:8px 0;
    border:none;
    border-radius:999px;
    font-size:0.9rem;
    cursor:pointer;
  }
  #checkAll{ background:#007aff; color:#fff; }
  #showKey{ background:#d0d0d0; }
</style>
</head>
<body>

<h1>Norden ‚Äì karta</h1>
<div class="subtitle">Fyll i l√§nder, huvudst√§der, √∂ar, sj√∂ar och hav/sund/vikar.</div>

<div class="map" id="map"></div>

<div id="info">
  F√∂r l√§nderna finns tv√• rutor: <b>Land</b> och <b>Stad</b> (huvudstad).
  N√§r landnamnet √§r r√§tt visas flaggan.
</div>
<div id="score"></div>

<div id="btns">
  <button id="checkAll">Kolla alla</button>
  <button id="showKey">Visa facit</button>
</div>

<script>
// ========= DATA =========

// L√§nder (placering i %, mittpunkt f√∂r bubblan)
const COUNTRIES = [
  { id:"se", country:"sverige", capital:"stockholm", left:50, top:60, flag:"üá∏üá™" },
  { id:"no", country:"norge",  capital:"oslo",      left:30, top:45, flag:"üá≥üá¥" },
  { id:"dk", country:"danmark",capital:"k√∂penhamn", left:38, top:74, flag:"üá©üá∞", altCap:["kopenhamn","copenhagen"] },
  { id:"fi", country:"finland",capital:"helsingfors",left:65, top:48, flag:"üá´üáÆ", altCap:["helsinki"] },
  { id:"is", country:"island", capital:"reykjavik", left:16, top:30, flag:"üáÆüá∏", altCap:["reykjav√≠k"] }
];

// √ñar
const ISLANDS = [
  { id:"gotland", name:"gotland", left:60, top:70 },
  { id:"oland",   name:"√∂land",   left:56, top:76 },
  { id:"aland",   name:"√•land",   left:55, top:52 }
];

// Sj√∂ar
const LAKES = [
  { id:"vanern",  name:"v√§nern",  left:44, top:61 },
  { id:"vatttern",name:"v√§ttern", left:47, top:66 },
  { id:"malaren", name:"m√§laren", left:49, top:58 }
];

// Hav / sund / vikar
const WATERS = [
  { id:"ostersjon",   names:["√∂stersj√∂n","ostersjon"], left:66, top:69 },
  { id:"nordsjon",    names:["nordsj√∂n","nordsjon"],   left:18, top:52 },
  { id:"bottenhavet", names:["bottenhavet"],          left:55, top:46 },
  { id:"bottenviken", names:["bottenviken"],          left:57, top:36 },
  { id:"finskaviken", names:["finska viken","finskaviken"], left:79, top:52 },
  { id:"skagerrak",   names:["skagerrak"],            left:32, top:63 },
  { id:"kattegatt",   names:["kattegatt"],            left:32, top:70 },
  { id:"oresund",     names:["√∂resund","oresund"],    left:39, top:78 }
];

// ========= HJ√ÑLP =========
function normalize(str){
  return str
    .toLowerCase()
    .trim()
    .replaceAll("√•","a")
    .replaceAll("√§","a")
    .replaceAll("√∂","o")
    .replaceAll("¬¥","")
    .replaceAll("`","")
    .replaceAll("‚Äô","")
    .replace(/[^a-z0-9 ]+/g," ")
    .replace(/\s+/g," ");
}
function cap(str){
  if(!str) return "";
  return str.charAt(0).toUpperCase() + str.slice(1);
}

// ========= BYGG KARTA =========
const mapEl = document.getElementById("map");
const scoreEl = document.getElementById("score");

const FIELDS = {}; // id -> info

// L√§nder: tv√• inputs per land + flagga
COUNTRIES.forEach(c=>{
  const cluster = document.createElement("div");
  cluster.className = "cluster";
  cluster.style.left = c.left+"%";
  cluster.style.top  = c.top+"%";

  const labels = document.createElement("div");
  labels.className = "label-row";
  const l1 = document.createElement("div");
  l1.className = "label-pill";
  l1.textContent = "Land";
  const l2 = document.createElement("div");
  l2.className = "label-pill";
  l2.textContent = "Stad";
  labels.appendChild(l1); labels.appendChild(l2);
  cluster.appendChild(labels);

  const row = document.createElement("div");
  row.className = "field-row";

  const landInput = document.createElement("input");
  landInput.placeholder = "t.ex. Sverige";
  landInput.className = "country-input";
  const capInput = document.createElement("input");
  capInput.placeholder = "t.ex. Stockholm";
  capInput.className = "capital-input";

  row.appendChild(landInput);
  row.appendChild(capInput);
  cluster.appendChild(row);

  const flagEl = document.createElement("div");
  flagEl.className = "flag";
  cluster.appendChild(flagEl);

  mapEl.appendChild(cluster);

  // Registrera f√§lt
  FIELDS["land-"+c.id] = {
    type:"land",
    group:c.id,
    input:landInput,
    answers:[c.country],
    flagEl,
    flag:c.flag,
    correct:false
  };
  FIELDS["cap-"+c.id] = {
    type:"capital",
    group:c.id,
    input:capInput,
    answers:[c.capital].concat(c.altCap || []),
    flagEl,
    flag:c.flag,
    correct:false
  };

  [landInput, capInput].forEach(inp=>{
    inp.autocomplete="off";
    inp.inputMode="text";
    inp.addEventListener("keydown",e=>{
      if(e.key==="Enter"){ checkOneByInput(inp); inp.blur(); }
    });
    inp.addEventListener("blur",()=>{ if(inp.value.trim()!=="") checkOneByInput(inp); });
  });
});

// √ñar, sj√∂ar, vatten: ett input per punkt
function addSingle(items, labelText){
  items.forEach(o=>{
    const cluster = document.createElement("div");
    cluster.className = "cluster small";
    cluster.style.left = o.left+"%";
    cluster.style.top  = o.top+"%";

    const lab = document.createElement("div");
    lab.className = "single-label";
    lab.textContent = labelText;
    cluster.appendChild(lab);

    const input = document.createElement("input");
    input.className = "single-input";
    cluster.appendChild(input);

    mapEl.appendChild(cluster);

    const names = o.names || [o.name];

    const id = labelText.toLowerCase()+"-"+o.id;
    FIELDS[id] = {
      type:labelText.toLowerCase(), // "√∂" | "sj√∂" | "hav/sund"
      input,
      answers:names,
      correct:false
    };

    input.autocomplete="off";
    input.inputMode="text";
    input.addEventListener("keydown",e=>{
      if(e.key==="Enter"){ checkOneByInput(input); input.blur(); }
    });
    input.addEventListener("blur",()=>{ if(input.value.trim()!=="") checkOneByInput(input); });
  });
}

addSingle(ISLANDS,"√ñ");
addSingle(LAKES,"Sj√∂");
addSingle(WATERS,"Hav");

// ========= KONTROLL =========
function checkOneByInput(input){
  const entryId = Object.keys(FIELDS).find(id => FIELDS[id].input === input);
  if(entryId) checkOne(entryId);
}

function checkOne(id){
  const field = FIELDS[id];
  const val = field.input.value;
  const norm = normalize(val);
  if(!norm){
    field.input.classList.remove("correct","wrong");
    field.correct=false;
    updateScore();
    return;
  }
  const ok = field.answers.some(a => normalize(a) === norm);
  field.correct = ok;

  if(ok){
    field.input.classList.add("correct");
    field.input.classList.remove("wrong");
    if(field.flagEl && field.type==="land"){
      field.flagEl.textContent = field.flag;
    }
  }else{
    field.input.classList.add("wrong");
    field.input.classList.remove("correct");
    if(field.flagEl && field.type==="land"){
      field.flagEl.textContent = "";
    }
  }
  updateScore();
}

function checkAll(){
  Object.keys(FIELDS).forEach(id=>{
    const f = FIELDS[id];
    if(f.input.value.trim()!=="") checkOne(id);
  });
  updateScore();
}

function showKey(){
  Object.keys(FIELDS).forEach(id=>{
    const f = FIELDS[id];
    const answer = f.answers[0];
    if(f.type==="land" || f.type==="capital" || f.type==="√∂" || f.type==="sj√∂" || f.type==="hav"){
      f.input.value = cap(answer);
    }else{
      f.input.value = cap(answer);
    }
    f.input.classList.add("correct");
    f.input.classList.remove("wrong");
    f.correct = true;
    if(f.flagEl && f.type==="land"){
      f.flagEl.textContent = f.flag;
    }
  });
  updateScore();
}

function updateScore(){
  const totalFields = Object.keys(FIELDS).length; // 24 f√§lt
  let correctCount = 0;
  Object.values(FIELDS).forEach(f=>{ if(f.correct) correctCount++; });
  scoreEl.textContent =
    `R√§tt svar: ${correctCount} av ${totalFields} (5 l√§nder + 5 huvudst√§der + 3 √∂ar + 3 sj√∂ar + 8 hav/sund/vikar)`;
}

document.getElementById("checkAll").addEventListener("click",checkAll);
document.getElementById("showKey").addEventListener("click",showKey);
</script>
</body>
</html>