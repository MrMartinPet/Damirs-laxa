<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Viljas L√§xapp ‚Äì Engelska glosor</title>
  <style>
    :root{ --bg:#f7f7f9; --fg:#111; --ok:#16a34a; --bad:#b91c1c; --card:#ffffff; --border:#e5e7eb; --accent:#111827 }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--fg); display:grid; place-items:center; padding:14px}
    .app{ width:min(720px,100%); background:var(--card); border:1px solid var(--border); border-radius:18px; padding:22px; box-shadow:0 8px 30px rgba(0,0,0,.05)}
    header{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
    h1{font-size:22px; margin:0}
    #score{font-weight:700}
    .sv{font-size:44px; font-weight:800; letter-spacing:.5px; margin:6px 0 14px}
    input[type="text"]{ width:100%; font-size:32px; padding:16px; border-radius:14px; border:1px solid var(--border); outline:none; -webkit-appearance:none; appearance:none }
    input[type="text"]:focus{ border-color:#9ca3af }
    .row{display:flex; gap:10px; margin-top:14px}
    button{ cursor:pointer; border:1px solid var(--border); background:var(--accent); color:#fff; border-radius:14px; padding:16px 18px; font-size:20px; flex:1; -webkit-tap-highlight-color:transparent }
    button.ghost{ background:#fff; color:#111 }
    .feedback{ min-height:40px; margin-top:12px; font-weight:800; font-size:24px }
    .ok{ color:var(--ok)} .bad{ color:var(--bad)}
    .progress{ height:8px; background:#eef2f7; border-radius:999px; overflow:hidden; margin:10px 0 0 }
    .progress>i{display:block;height:100%;width:0;background:#111827}
  </style>
</head>
<body>
  <main class="app" role="application">
    <header>
      <h1>Viljas l√§xapp</h1>
      <div id="score">0 / 0</div>
    </header>

    <div class="progress" aria-hidden="true"><i id="bar"></i></div>

    <section aria-live="polite">
      <div class="sv" id="sv"></div>
      <input id="answer" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" inputmode="latin" enterkeyhint="done" />

      <div class="row" id="actionRow">
        <button id="check">Kontrollera</button>
        <button class="ghost" id="hint">Ledtr√•d</button>
      </div>

      <div class="row" id="resultRow" style="display:none">
        <button class="ghost" id="listen">Lyssna igen</button>
        <button id="next">N√§sta ord</button>
      </div>

      <div class="feedback" id="feedback"></div>
    </section>
  </main>

  <script>
    // Ordlistan (fr√•n fotot)
    const WORDS = [
      { sv: 'Hus', en: 'house' },
      { sv: 'Tak', en: 'roof' },
      { sv: 'Skorsten', en: 'chimney' },
      { sv: 'F√∂nster', en: 'windows' },
      { sv: 'Bredvid', en: 'beside' },
      { sv: 'H√∂ger', en: 'right' },
      { sv: 'G√•ng / stig', en: 'path' },
      { sv: 'Tr√§dg√•rd', en: 'garden' },
      { sv: 'Tr√§', en: 'wood' },
      { sv: 'Sten', en: 'stone' },
    ];

    const svEl = document.getElementById('sv');
    const input = document.getElementById('answer');
    const checkBtn = document.getElementById('check');
    const hintBtn = document.getElementById('hint');
    const feedback = document.getElementById('feedback');
    const scoreEl = document.getElementById('score');
    const bar = document.getElementById('bar');
    const resultRow = document.getElementById('resultRow');
    const actionRow = document.getElementById('actionRow');
    const listenBtn = document.getElementById('listen');
    const nextBtn = document.getElementById('next');

    let deck = shuffle([...WORDS]);
    let index = 0;
    let correct = 0;

    // Web Audio (inga ljudfiler)
    const audio = new (window.AudioContext || window.webkitAudioContext)();
    function tone(freq, duration=0.18){ try{ const o = audio.createOscillator(); const g = audio.createGain(); o.frequency.value=freq; o.type='sine'; o.connect(g); g.connect(audio.destination); g.gain.setValueAtTime(0.0001,audio.currentTime); g.gain.exponentialRampToValueAtTime(0.4,audio.currentTime+0.01); o.start(); g.gain.exponentialRampToValueAtTime(0.0001,audio.currentTime+duration); o.stop(audio.currentTime+duration);}catch(e){} }
    function chimeOK(){ tone(660,0.12); setTimeout(()=>tone(880,0.14),90); }
    function buzzBad(){ tone(140,0.22); setTimeout(()=>tone(110,0.22),120); }

    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }

    function speak(word){ try{ const u=new SpeechSynthesisUtterance(word); u.lang='en-US'; const v=window.speechSynthesis.getVoices().find(x=>/en-/i.test(x.lang)); if(v) u.voice=v; u.rate=0.95; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u);}catch(e){} }

    function updateCounters(){ scoreEl.textContent = `${correct} / ${index}`; bar.style.width = Math.round((index/deck.length)*100)+'%'; }

    function showQuestion(){
      const w = deck[index];
      svEl.textContent = w.sv;
      input.value = '';
      input.disabled = false;
      input.focus({preventScroll:true});
      feedback.textContent = '';
      feedback.className = 'feedback';
      actionRow.style.display = '';
      resultRow.style.display = 'none';
      hintBtn.disabled = false;
      updateCounters();
    }

    function finish(){
      svEl.textContent = 'Klart! üéâ';
      feedback.className = 'feedback ok';
      feedback.textContent = `Po√§ng: ${correct} av ${deck.length}`;
      input.disabled = true; actionRow.style.display='none'; resultRow.style.display='none';
      bar.style.width='100%'; scoreEl.textContent = `${correct} / ${deck.length}`;
    }

    checkBtn.addEventListener('click', () => {
      if(audio.state==='suspended'){ audio.resume(); }
      const w = deck[index];
      const guess = (input.value||'').trim().toLowerCase();
      if(!guess){ input.focus(); return; }
      const target = w.en.toLowerCase();
      if(guess === target){
        correct++; chimeOK();
        feedback.className = 'feedback ok'; feedback.textContent = 'R√§tt! ‚úîÔ∏è';
        actionRow.style.display = 'none'; // ta bort ledtr√•dsknappen n√§r r√§tt
        resultRow.style.display = '';
        input.disabled = true;
        setTimeout(()=>{ speak(w.en); }, 500); // spela upp efter ~0.5 s
      } else {
        buzzBad();
        feedback.className = 'feedback bad';
        const lead = target.slice(0,2);
        feedback.textContent = `Fel. Ledtr√•d: ${lead}‚Ä¶`;
        // hintknappen kvar om man vill prova igen
        input.focus();
      }
    });

    hintBtn.addEventListener('click', () => {
      const target = deck[index].en.toLowerCase();
      const lead = target.slice(0,2);
      feedback.className = 'feedback';
      feedback.textContent = `Ledtr√•d: ${lead}‚Ä¶`;
      input.focus();
    });

    listenBtn.addEventListener('click', ()=>{ speak(deck[index].en); });

    nextBtn.addEventListener('click', ()=>{
      index++;
      if(index>=deck.length){ finish(); return; }
      showQuestion();
    });

    // Init
    showQuestion();
  </script>
</body>
</html>
